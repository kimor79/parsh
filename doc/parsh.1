.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.35
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "PARSH 1"
.TH PARSH 1 "2010-03-02" "" ""
.SH "NAME"
parsh \- Parallel SSH client
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
parsh [\-1Qhqrsv] [\-\-nodetach] [\-e rate] [\-c command] [\-j jobs] [\-l user]
[\-u source:destination] node [node [...]]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
parsh is a program for executing commands on remote machines in parallel. One
benefit of parsh over traditional for i in ... loop implementations is that
parsh captures \s-1STDOUT\s0, \s-1STDERR\s0 and the exit status of the remote command. In
addition everything is logged to a central database. See the \*(L"\s-1CENTRAL\s0 \s-1DATABASE\s0\*(R"
section for more information.
.SH "NODES"
.IX Header "NODES"
Any combination of nodes, nodegroups and nodegroup expressions may be given on
the command line.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-1\fR" 4
.IX Item "-1"
Normally parsh will prompt for your corporate realm credentials and the realm
credentials of the target node. This option instructs parsh to to use only your
corporate credentials.
.IP "\fB\-Q\fR" 4
.IX Item "-Q"
Only print fatal errors. This option is meaningless unless \fB\-\-nodetach\fR is also
given.
.IP "\fB\-c\fR \fIcommand\fR, \fB\-\-command\fR \fIcommand\fR" 4
.IX Item "-c command, --command command"
The command to execute on remote machines. Be aware of your shell's quoting rules.
May be used multiple times.
.IP "\fB\-e\fR \fInumber\fR|\fIpercentage\fR" 4
.IX Item "-e number|percentage"
The number of failures to allow before abandoning the job. This can be either
a whole number or a percentage. After this many nodes have failed, parsh will not
run against any more nodes. The default is to stop after 10% failures.
.IP "\fB\-h\fR, \fB\-\-help\fR" 4
.IX Item "-h, --help"
Display a short help message.
.IP "\fB\-j\fR \fIjobs\fR, \fB\-\-jobs\fR \fIjobs\fR" 4
.IX Item "-j jobs, --jobs jobs"
How many remote machines to connect to at once. The default is 10.
.IP "\fB\-l\fR \fIuser\fR, \fB\-\-login\fR \fIuser\fR" 4
.IX Item "-l user, --login user"
Login as \fIuser\fR. Use this option if you need to login to the remote machines as a
different user.
.IP "\fB\-q\fR, \fB\-\-quiet\fR" 4
.IX Item "-q, --quiet"
Only print warnings and errors. This option is meaningless unless \fB\-\-nodetach\fR is
also given.
.IP "\fB\-r\fR, \fB\-\-root\fR" 4
.IX Item "-r, --root"
This option will cause parsh to watch for password prompts ('Password:')
on \s-1STDOUT\s0. The root password will be prompted for upon invocation. When a prompt
is encountered, the root password requested earlier will be sent to the prompt.
.IP "\fB\-s\fR, \fB\-\-sudo\fR" 4
.IX Item "-s, --sudo"
This option will cause parsh to watch for password prompts ('Password:')
on \s-1STDERR\s0. When a prompt is encountered, the password requested earlier will be
sent to the prompt.
.IP "\fB\-u\fR \fIsource:destination\fR, \fB\-\-upload\fR \fIsource:destination\fR" 4
.IX Item "-u source:destination, --upload source:destination"
Use this option to upload files before the command is executed. Multiple files
can be uploaded by specifying this opton multiple times. See the \*(L"\s-1FILE\s0 \s-1UPLOADING\s0\*(R"
section for more information including caveats.
.IP "\fB\-v\fR, \fB\-\-verbose\fR" 4
.IX Item "-v, --verbose"
Increase verbosity. May be used multiple times. This option is meaningless unless
<B\*(--nodetach> is also given.
.SH "CENTRAL DATABASE"
.IX Header "CENTRAL DATABASE"
Upon successful invocation, parsh will request a job \s-1ID\s0 from the central database.
Stored in the database will be the command, the 'run as' user, any files
to be uploaded, the nodes to run on and the start time.
.PP
As parsh connects to each remote machine, an entry will be added to the central
database with the job \s-1ID\s0, node and start time. As each node finishes, the
exit status, \s-1STDOUT\s0 and \s-1STDERR\s0, and finish time will be appended to the entry.
If parsh was not able to connect to the remote machine, the exit status will be \-1 and
the entry will contain an error message indicating the failure. If parsh was able
to connect to the remote machine, then the exit status will be the exit status
from the last command or the last uploaded file if no command was given. If any file
fails to upload or any command exits non\-zero, parsh will not continue with that node.
.PP
After all remote machines have been acted upon, the finish time of the job will be
recorded in the database.
.SH "FILE UPLOADING"
.IX Header "FILE UPLOADING"
Parsh's file uploading is trivial at best. Only files are supported at this time.
Permissions on the source file will be applied to the destination. In basic terms,
this is what happens to upload a file:
.PP
.Vb 2
\&  cat $source | ssh $node "cat - > $destination"
\&  ssh $node "chmod #### $destination"
.Ve
.SH "EXAMPLES"
.IX Header "EXAMPLES"
Run the command \f(CW\*(C`ls /tmp\*(C'\fR on util1.sjc1 and util1.bom1:
.PP
.Vb 1
\&  parsh -c 'ls /tmp' util1.sjc1 util1.bom1
.Ve
.PP
Run the command \f(CW\*(C`w\*(C'\fR on all db class servers in sjc1:
.PP
.Vb 1
\&  parsh -c 'ls /tmp' '&intersect(@nodes.model_id.10,@nodes.site_id.1)'
.Ve
.PP
Upload the file \fIfoo\fR to \fI/tmp/foo\fR on helios1.sjc1:
.PP
.Vb 1
\&  parsh -u foo:/tmp/foo helios1.sjc1
.Ve
.PP
Upload the file \fIfoo.sh\fR and then execute it:
.PP
.Vb 1
\&  parsh -u foo.sh:/tmp/foo.sh -c '/tmp/foo.sh'
.Ve
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fBssh\fR(1), \fBsudo\fR(8)
.SH "BUGS"
.IX Header "BUGS"
Normally parsh will detach from the current terminal. This is not the case
if \fB\-r\fR or \fB\-s\fR are given.
.SH "AUTHOR"
.IX Header "AUTHOR"
Kimo Rosenbaum <kimor79 @ yahoo.com>
