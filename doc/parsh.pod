=head1 NAME

parsh - Parallel SSH client

=head1 SYNOPSIS

parsh [-1Qhqrsv] [--nodetach] [-e rate] [-c command] [-j jobs] [-l user]
[-u source:destination] node [node [...]]

=head1 DESCRIPTION

parsh is a program for executing commands on remote machines in parallel. One
benefit of parsh over traditional for i in ... loop implementations is that
parsh captures STDOUT, STDERR and the exit status of the remote command. In
addition everything is logged to a central database. See the L</"CENTRAL DATABASE">
section for more information.

=head1 NODES

Any combination of nodes, nodegroups and nodegroup expressions may be given on
the command line.

=head1 OPTIONS

=over

=item B<-1>

Normally parsh will prompt for your corporate realm credentials and the realm
credentials of the target node. This option instructs parsh to to use only your
corporate credentials.

=item B<-Q>

Only print fatal errors. This option is meaningless unless B<--nodetach> is also
given.

=item B<-c> I<command>, B<--command> I<command>

The command to execute on remote machines. Be aware of your shell's quoting rules.
May be used multiple times.

=item B<-e> I<number>|I<percentage>

The number of failures to allow before abandoning the job. This can be either
a whole number or a percentage. After this many nodes have failed, parsh will not
run against any more nodes. The default is to stop after 10% failures.

=item B<-h>, B<--help>

Display a short help message.

=item B<-j> I<jobs>, B<--jobs> I<jobs>

How many remote machines to connect to at once. The default is 10.

=item B<-l> I<user>, B<--login> I<user>

Login as I<user>. Use this option if you need to login to the remote machines as a
different user.

=item B<-q>, B<--quiet>

Only print warnings and errors. This option is meaningless unless B<--nodetach> is
also given.

=item B<-r>, B<--root>

This option will cause parsh to watch for password prompts ('Password:')
on STDOUT. The root password will be prompted for upon invocation. When a prompt
is encountered, the root password requested earlier will be sent to the prompt.

=item B<-s>, B<--sudo>

This option will cause parsh to watch for password prompts ('Password:')
on STDERR. When a prompt is encountered, the password requested earlier will be
sent to the prompt.

=item B<-u> I<source:destination>, B<--upload> I<source:destination>

Use this option to upload files before the command is executed. Multiple files
can be uploaded by specifying this opton multiple times. See the L<"FILE UPLOADING">
section for more information including caveats.

=item B<-v>, B<--verbose>

Increase verbosity. May be used multiple times. This option is meaningless unless
<B--nodetach> is also given.

=back

=head1 CENTRAL DATABASE

Upon successful invocation, parsh will request a job ID from the central database.
Stored in the database will be the command, the 'run as' user, any files
to be uploaded, the nodes to run on and the start time.

As parsh connects to each remote machine, an entry will be added to the central
database with the job ID, node and start time. As each node finishes, the
exit status, STDOUT and STDERR, and finish time will be appended to the entry.
If parsh was not able to connect to the remote machine, the exit status will be -1 and
the entry will contain an error message indicating the failure. If parsh was able
to connect to the remote machine, then the exit status will be the exit status
from the last command or the last uploaded file if no command was given. If any file
fails to upload or any command exits non-zero, parsh will not continue with that node.

After all remote machines have been acted upon, the finish time of the job will be
recorded in the database.

=head1 FILE UPLOADING

Parsh's file uploading is trivial at best. Only files are supported at this time.
Permissions on the source file will be applied to the destination. In basic terms,
this is what happens to upload a file:

  cat $source | ssh $node "cat - > $destination"
  ssh $node "chmod #### $destination"

=head1 EXAMPLES

Run the command C<ls /tmp> on util1.sjc1 and util1.bom1:

  parsh -c 'ls /tmp' util1.sjc1 util1.bom1

Run the command C<w> on all db class servers in sjc1:

  parsh -c 'ls /tmp' '&intersect(@nodes.model_id.10,@nodes.site_id.1)'

Upload the file F<foo> to F</tmp/foo> on helios1.sjc1:

  parsh -u foo:/tmp/foo helios1.sjc1

Upload the file F<foo.sh> and then execute it:

  parsh -u foo.sh:/tmp/foo.sh -c '/tmp/foo.sh'

=head1 SEE ALSO

B<ssh>(1), B<sudo>(8)

=head1 BUGS

Normally parsh will detach from the current terminal. This is not the case
if B<-r> or B<-s> are given.

=head1 AUTHOR

Kimo Rosenbaum <kimor79 @ yahoo.com>
